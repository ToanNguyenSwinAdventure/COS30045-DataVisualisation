<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3.js Bar Chart Example</title>
  <!-- Include D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <div id="chart"></div>
  <button id="update">Update</button>
  <button id="add">Add</button>
  <button id="remove">Remove</button>
  <button id="sortAsc">Sort Ascending</button>
  <button id="sortDsc">Sort Descending</button>

  <script>
    var w = 500;
    var h = 300;
    var padding = 35;

    var svg = d3.select("#chart")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

    // Sample dataset
    var dataset = [];

    d3.csv("../Processed_Data/Life_expectancy.csv").then(function(data) {
      dataset = data.map(function(d) {
        return +d['Life Expectancy'];
      });
      drawChart(dataset);
    });

    function drawChart(data) {
      var xScale = d3.scaleBand()
                     .domain(d3.range(data.length))
                     .range([padding, w - padding])
                     .paddingInner(0.05);

      var yScale = d3.scaleLinear()
                     .domain([0, d3.max(data)])
                     .range([h - padding, padding]);

      svg.selectAll("rect")
         .data(data)
         .enter()
         .append("rect")
         .attr("x", function(d, i) {
           return xScale(i);
         })
         .attr("y", function(d) {
           return yScale(d);
         })
         .attr("width", xScale.bandwidth())
         .attr("height", function(d) {
           return h - padding - yScale(d);
         })
         .attr("fill", function(d) {
           return "rgb(0, 0, " + Math.round(d * 10) + ")";
         });

      // Tooltip
      svg.selectAll("rect")
         .on("mouseover", function(event, d) {
           d3.select(this).attr("fill", "orange");
           var xPos = parseFloat(d3.select(this).attr("x")) + xScale.bandwidth() / 2;
           var yPos = parseFloat(d3.select(this).attr("y")) + 15;
           svg.append("text")
              .attr("id", "tooltip")
              .attr("x", xPos)
              .attr("y", yPos)
              .text(d);
         })
         .on("mouseout", function() {
           d3.select(this).attr("fill", function(d) {
             return "rgb(0, 0, " + Math.round(d * 10) + ")";
           });
           d3.select("#tooltip").remove();
         });
    }

    // Update button
    d3.select("#update")
      .on("click", function() {
        dataset.forEach(function(d, i) {
          dataset[i] = Math.floor(Math.random() * 100); // Update with random values
        });
        updateChart(dataset);
      });

    // Add button
    d3.select("#add")
      .on("click", function() {
        var newValue = Math.floor(Math.random() * 100);
        dataset.push(newValue);
        updateChart(dataset);
      });

    // Remove button
    d3.select("#remove")
      .on("click", function() {
        dataset.pop();
        updateChart(dataset);
      });

    // Sort Ascending button
    d3.select("#sortAsc")
      .on("click", function() {
        dataset.sort(d3.ascending);
        updateChart(dataset);
      });

    // Sort Descending button
    d3.select("#sortDsc")
      .on("click", function() {
        dataset.sort(d3.descending);
        updateChart(dataset);
      });

    function updateChart(data) {
      var yScale = d3.scaleLinear()
                     .domain([0, d3.max(data)])
                     .range([h - padding, padding]);

      svg.selectAll("rect")
         .data(data)
         .transition()
         .duration(500)
         .attr("y", function(d) {
           return yScale(d);
         })
         .attr("height", function(d) {
           return h - padding - yScale(d);
         });
    }
  </script>
</body>
</html>
